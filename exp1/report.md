# MPI 异步通信小作业 实验报告 

秦铁荥 2022012388

## 任务一

InfiniBand:


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        | 1.20   | 4.31   |
| 2    | 2        | 1.15   | 8.60   |
| 3    | 4        | 1.11   | 17.34  |
| 4    | 8        | 1.09   | 35.30  |
| 5    | 16       | 1.09   | 68.44  |
| 6    | 32       | 1.14   | 142.25 |
| 7    | 64       | 1.26   | 243.67 |
| 8    | 128      | 1.34   | 475.40 |
| 9    | 256      | 1.91   | 923.62 |
| 10   | 512      | 1.96   |1685.26 |
| 11   | 1024     | 2.21   |2550.44 |
| 12   | 2048     | 2.69   |3809.90 |
| 13   | 4096     | 3.61   |3803.99 |
| 14   | 8192     | 5.17   |9176.58 |
| 15   | 16384    | 7.06   |10335.29|
| 16   | 32768    | 9.69   |10768.43|
| 17   | 65536    | 15.01  |11539.52|
| 18   | 131072   | 26.11  |11816.43|
| 19   | 262144   | 32.24  |11924.71|
| 20   | 524288   | 57.49  |12006.29|
| 21   | 1048576  | 100.01 |12041.52|
| 22   | 2097152  | 186.39 |12053.88|
| 23   | 4194304  | 361.66 |12059.34|

以太网：


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        | 44.95  |  0.30  |
| 2    | 2        | 45.15  |  0.60  |
| 3    | 4        | 44.99  |  1.21  |
| 4    | 8        | 45.19  |  2.36  |
| 5    | 16       | 45.29  |  5.09  |
| 6    | 32       | 45.50  |  9.25  |
| 7    | 64       | 46.52  | 16.62  |
| 8    | 128      | 48.08  | 33.61  |
| 9    | 256      | 52.88  | 55.55  |
| 10   | 512      | 58.57  | 80.87  |
| 11   | 1024     | 70.40  | 95.76  |
| 12   | 2048     | 87.70  | 105.20 |
| 13   | 4096     | 109.71 | 110.95 |
| 14   | 8192     | 185.55 | 114.20 |
| 15   | 16384    | 216.52 | 116.05 |
| 16   | 32768    | 364.24 | 116.87 |
| 17   | 65536    | 635.61 | 117.11 |
| 18   | 131072   |1198.32 | 117.38 |
| 19   | 262144   |2414.02 | 117.52 |
| 20   | 524288   |4645.12 | 117.57 |
| 21   | 1048576  |9089.52 | 117.61 |


- 请描述当消息长度增加时，带宽和延迟分别呈现出什么样的趋势？

延迟先稳定后增长趋稳，带宽先快速增长后趋于饱和，二者变化拐点一致。

- 该趋势在两种网络下有何不同？

InfiniBand 的延迟增长更缓慢，带宽更快饱和，而以太网的延迟增长更明显，带宽饱和点更低。

- 为什么会有这样的趋势？

网络传输带宽有上限，达到上限后只能增加传输时间来传输更大的文件。

- 对比InfiniBand和以太网络下的带宽和延迟，它们之间的差距是多少？

InfiniBand 延迟约为以太网的 1/40，带宽约为其 100 倍。

## 任务二

| 编号 | 消息长度  | 计算量 | mpi_sync 总耗时 | mpi_async  总耗时 |
| ---- | --------- | ------ | --------------- | ----------------- |
| 1    | 100000000 | 10     | 936.84 ms       | 848.413 ms        |
| 2    | 100000000 | 20     | 1036.51 ms      | 837.51 ms         |
| 3    | 100000000 | 40     | 1240.01 ms      | 849.592 ms        |
| 4    | 100000000 | 80     | 1641.18 ms      | 837.897 ms        |
| 5    | 100000000 | 160    | 2445.65 ms      | 1600.28 ms        |

- 通信时间和计算时间满足什么关系时，非阻塞通信程序能完美掩盖通信时间？

当通信时间小于或等于计算时间时，非阻塞通信能完美掩盖通信时间。

- 简述两份代码的不同之处。

在每轮迭代中，非阻塞通信使用了 MPI_Wait 来等待数据传输完成。


